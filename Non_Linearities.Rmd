---
title: "Meta‐analysis of non‐linear effect modification using individual participant data using generalised additive mixed effects models: A new approach"
author: "Michail Belias"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
  - \usepackage{bbm}
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{dsfont}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
output:
 word_document:
  reference_docx: Style and bibliography/templatePaper.docx
 html_document:
  df_print: paged
 pdf_document:
    fig_caption: yes
    fig_crop: no
    fig_height: 8
    fig_width: 6
    highlight: haddock
 indent: true  
csl: Style and bibliography/journal-of-clinical-epidemiology.csl
fontsize: 14pt 
sansfont : GFS Neohellenic
bibliography: Style and bibliography/bibliography2.bib
---


```{r global_options , echo=FALSE, message=FALSE, warning= FALSE}
rm(list=ls()) ### To clear namespace

# Libraries for loading and saving data
## Load data-set for loading xlsx data-sets
if(!require("readr")) install.packages("readr")
## Load readxl for loading xlsx data-sets
if(!require("readxl")) install.packages("readxl")
## Load haven for loading sas data-sets 
if(!require("haven")) install.packages("haven")

################################################
# Libraries for plotting
## Load ggpubr for plotting
if(!require("ggpubr")) install.packages("ggpubr") # automatically loads the ggplot2
## Load gridExtra  to arrange multiple grid-based plots on a page, and draw tables
if(!require("gridExtra")) install.packages("gridExtra")
## Load ggsci for better looking colors
if(!require("ggsci")) install.packages("ggsci")
## Load sjPlot to get easy statistical summaries and plots
if(!require("sjPlot")) install.packages("sjPlot")
## Load itsadug to have nice plots of GAMMs
if(!require("itsadug")) install.packages("itsadug")
## Load magick for graphics and image processing in R
if(!require("magick")) install.packages("magick")
## Load webshot for tranforming HTML objects into pictures
if(!require("webshot")) install.packages("webshot")
## Load lme4 for lme4
if(!require("pander")) install.packages("pander")
## Load kableExtra for better looking kable objects
if(!require("kableExtra")) install.packages("kableExtra") # automatically loads kable

################################################
# Libraries for data manipulation
## Load knitr for fine tuning
if(!require("knitr")) install.packages("knitr")
## Load dplyr for data manipulation
if(!require("dplyr")) install.packages("dplyr")

################################################
# Libraries for the statistical analysis 
## Load lme4 for lme4
if(!require("lme4")) install.packages("lme4")
## Load mfp to fit multi-variable fractional polynomials
if(!require("mfp")) install.packages("mfp")
## Load lmerTest to add information into the summaries  
if(!require("lmerTest")) install.packages("lmerTest")
## Load mcgv to fit gamms and bamm
if(!require("mgcv")) install.packages("mgcv")
################################################



## General output of the chunks 
opts_chunk$set(fig.path='Figs/',                # The path where to save the figures
               echo=F,                          # Logical whether the chunck will be printed 
               warning=FALSE,                   # Logical whether the warnings will be printed
               message=FALSE,                   # Logical whether the messages will be printed
               fig.pos = " ",                   # The position of the 
               comment = ""                     #
               )

options(knitr.table.format = "html")


Sys.setenv(PATH=paste(Sys.getenv("PATH"),"C:/Program Files/MiKTeX 2.9/miktex/bin/x64/",sep=";"))
Sys.setenv(R_GSCMD = "/usr/local/bin/gs")
```


```{r loading the datasets}
IPDMA <- read_sas("Data/IPDMA.sas7bdat")
names(IPDMA) <- tolower(names(IPDMA))
IPDMA$treat =  factor(IPDMA$treat  , labels = c("Placebo","Antibiotics") )
IPDMA$study = factor(IPDMA$study, labels = c("Damoiseaux","Burke","Appelman","Little","Saux","McCormick"))
IPDMA$bilat_0 =  factor(IPDMA$bilat_0  , labels = c("No","Yes") )
Tubano <- read_csv("Data/VolledigeDS.csv")
somatostatin <- read_sav("Data/somatostatin.sav")
source("Data/somatostatin_descriptives.R")

```

\newpage

## Background

Individual participant data(IPD) meta-analysis(MA) is considered the gold standard since a variety of opportunities are offered. The investigation of treatment-effect modification is one of them, Nevertheless, effect modification over a continuous co-variables may be challenging, as non-linear interactions may be present. Most methods either ignore non-linear effect modification, or use a forward technique to model non-linearities that relies on statistical tests with arbitrary significance levels.

## Objective 
We propose a new approach to model and investigate treatment-effect modification, while modelling non-linear associations using smoothing splines. 

## Methods



## Results



## Conclusion


\newpage

##### 

# 1. Introduction

####### One of the main goals of an individual participant data (IPD) meta-analysis (MA) is to investigate treatment effect differences associated with patient characteristics [@Simmonds_2015]. Modification of treatment effect over continuous variables may be challenging to investigate because the association between the outcome and the effect modifier and/or the interaction may not be linear. Regression based approaches are often used and their strategies include either ignoring, assuming known, or estimating functional shapes. Nevertheless, the first two strategies require assumptions that may not be true, and/or a-priori knowledge that may not be present, while estimating a non-linear functional shape involves step-wise procedures that rely on multiple testing and arbitrary significance levels. On the other hand, generalised additive mixed effect models (GAMMs) with smoothing splines are more flexible. GAMMs are penalised regressions that account for non-linearities and can be considered a superset of generalised linear mixed effects models GLMMs. Thereto, we may benefit from the flexibility offered by smoothing splines and present effect modification as a function, avoiding statistical testing. 
####### IPD-MA may be conducted using either one or two-stages. In one-stage IPD-MA an appropriate mixed effects model is applied accounting for within study clustering of the participants. In two-stage IPD-MA, an appropriate statistical model is applied per study. Thereto, the either the estimates of interest or the regression lines are extracted and subsequently pooled using typical meta-analytical methods. One stage methods have greater or equal power [@Simmonds_2007], but need careful modeling and expertise [@Fisher_2011]. 
#######  A naive approach is to ignore a non-linear functional form either through categorisation or using the continuous variable as it is. Categorization involves splitting the continuous co-variable into subgroups, due to some clinical reasoning. For instance, the risk of developing ovarian cancer may be associated with menopause. Therefore, if age is a potential effect modifier it is reasonable to categorise the age to younger ($\leq$ 50 years older) and older (> 50 years old) participants. Due to loss of information categorization has been criticised for misspecification, reduced power, inflation of the type I error rates and biased results [@Royston_2005 ; @Altman_2006 ; @Austin_2004 ; @Maxwell_1993 ; @Weinberg_1995]. When a-priori clinical reasoning for the subgroups is not available, tree-based approaches have been proposed to estimate subgroups [@Zeileis_2008; @Seibold_2016 ; @Su_2009 ; @Mistry_2018 ; @Fokkema_2017]. Nevertheless, these approaches rely on statistical tests with arbitrary levels of significance and are usefull when the underlying functional form is a step function. On the other hand, fitting a linear model while the underlying association in not linear will by definition produce biased results. Nevertheless, often potential effect modifiers are often associated with the outcome and have been investigated as prognostic factors. Thereby, a non-linear baseline functional form may be already known. For instance, BMI and blood pressure may have a J-shaped association. Researchers then may investigate potential anti-hypertensive treatment effect modification by BMI, while including quadratic terms. Nevertheless, the BMI and blood pressure functional shape on the treated group may not be quadratic. 

####### Regression-methods to estimate functional shapes involve . Royston and Altman [@Royston_1994] introduced fractional polynomials in order to model non-linear associations. Fractional polynomials receive their degrees from a fixed set $S$= {-2, -1, -0.5, ln, 0.5, 1, 2, 3}. Subsequently, Royston and Sauerbrei [@Royston_2004] extended their strategy to model treatment effects over a continuous co-variable involving interaction. Nevertheless, both approaches were limited to single studies. In a subsequent article they extended their proposal to IPD-MA using a two-stage approach [@Sauerbrei_2011]. In the fist stage, a fractional polynomial is selected using one of the following three methods : 1) the best fitting overall FP, 2) the best fitting -per trial- second degree FP2 3) the best fitting -per trial- FP which can be any combination of linear, FP1 or FP2. Then a treatment effect function per trial is estimated and as a second step pooled using point-wise meta-analysis. Nevertheless, the assumption that the outcome-effect modifier association has the same shape in both treatment arms may not be true. Furthermore, fractional polynomials rely on tests and the choice of  $\alpha$ significance levels may be arbitrary. Finally, FPs are global polynomial functions and may not fit well on the boundaries of the continuous effect modifier and may be prone to power loss when the per trial mean of the continuous effect modifier is highly heterogeneous [@Simmonds_2007]. 


#######  For this, various approaches to account for non-linear associations have been developed, such as splines and fractional polynomials (FP) [@Sauerbrei_2011]. For IPD-MA, regression-based approaches such as linear models, piecewise polynomials, FPs and smoothing splines may be performed either in one or two stages. In a two-stage approach, each trial is first modelled separately using an appropriate statistical model. Subsequently, we pool either the extracted coefficients if shared across the trials or their fitted functions, using standard meta-analytical tools. In contrast, in one-stage IPD-MA the IPD from all trials are analysed simultaneously whilst accounting for the clustering of participants within studies  . Hereto, we model interactions between treatment and patient-level variables while accounting also for the shape of the associations with the outcome. Recent recommendations suggest mean-centring the potential effect modifiers per trial in order to account for potential ecological   bias due to unadjusted confounding. In such a one-stage model, within-trial clustering can be accounted for using either a fixed effect (common intercept/slope), fixed effects (stratified intercept/slope), or random effects [@Legha_2018]. Other methods   to explore effect modification are plot- and tree-based methods such as the generalised linear mixed-effects model tree (GLMM-tree) method [@Wang_2016] or meta-stepp, a moving average (sliding window) method. 


Nevertheless, all the above either rely on statistical tests with arbitrary significance levels, assumptions that may not be true, or a-priori knowledge that might not be present.

Furthermore, although the association between the outcome and the continuous effect modifier is highly informative, clinical decisions are based on subgroups of participants the differ in treatment response. Finally, subgroups generated from continuous variables are defined by the cut-points were the treatment effect is considered to change. These cut-points may be based on the treatment effect function [@@royston_interaction_2013], i.e. the difference between the two treatments over the range of the covariable or the treatment-effect modifier interaction terms [@Sun_2010]. 
\par        Although there is a large variety of methods to explore effect modification for continuous covariates, little guidance exists on their use. We aim to describe and illustrate the aforementioned methods by applying them on two empirical examples, while discussing their (potential) advantages and limitations.





##### 
\newpage 
